
package utilities;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.util.ArrayList;
import java.util.List;

import security.UserAccount;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

import domain.Administrator;
import domain.ApplicationFor;
import domain.Auditor;
import domain.DomainEntity;
import domain.Story;

public class Json {

	static final List<DomainEntity>	objectList	= new ArrayList<DomainEntity>();
	static int						id			= 0;


	public static void main(final String[] args) {
		//Para parsear las fechas
		//final Gson gson = new GsonBuilder().setDateFormat("dd/MM/yyyy").create();
		final BufferedReader reader;
		final JsonParser parser;
		try {
			parser = new JsonParser();
			reader = new BufferedReader(new FileReader("./src/main/java/utilities/json.txt"));
			final JsonElement datos = parser.parse(reader);
			Json.dumpJSONElement(datos);
			System.out.println(Json.objectList);
		} catch (final FileNotFoundException e) {
			e.printStackTrace();
		}

	}
	public static void dumpJSONElement(final JsonElement elemento) {
		DomainEntity object;
		final JsonObject jsonObject = elemento.getAsJsonObject();
		final java.util.Set<java.util.Map.Entry<String, JsonElement>> entradas = jsonObject.entrySet();
		for (final java.util.Map.Entry<String, JsonElement> map : entradas)
			if (map.getValue().isJsonArray()) {
				//Si es un array significa que hay más de un objeto de esa clase
				final JsonArray array = map.getValue().getAsJsonArray();
				final java.util.Iterator<JsonElement> iter = array.iterator();
				while (iter.hasNext()) {
					final JsonElement entrada = iter.next();
					object = Json.devuelveObjetoJava(map.getKey(), entrada);
					if (object != null) {
						Json.id++;
						object.setId(Json.id);
						Json.objectList.add(object);
					} else
						System.out.println("ERROR: Don't exist the domain with name: " + map.getKey());
				}
			} else {
				object = Json.devuelveObjetoJava(map.getKey(), map.getValue());
				if (object != null) {
					Json.id++;
					object.setId(Json.id);
					Json.objectList.add(object);
				} else
					System.out.println("ERROR: Don't exist the domain with name: " + map.getKey());

			}
	}
	private static DomainEntity devuelveObjetoJava(final String domain, final JsonElement jsonElement) {
		final Gson gson = new GsonBuilder().setDateFormat("dd/MM/yyyy").create();
		DomainEntity res = null;
		switch (domain) {
		case "UserAccount":
			res = gson.fromJson(jsonElement, UserAccount.class);
		case "Administrator":
			res = gson.fromJson(jsonElement, Administrator.class);
		case "ApplicationFor":
			res = gson.fromJson(jsonElement, ApplicationFor.class);
		case "Auditor":
			res = gson.fromJson(jsonElement, Auditor.class);
		case "Story":
			res = gson.fromJson(jsonElement, Story.class);
		}

		return res;
	}
}
